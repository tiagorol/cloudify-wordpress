node_types:

  wordpress.nodes.MySQLDatabase:
    derived_from: cloudify.nodes.DBMS
    properties:
      port:
        description: MySQL port
        type: integer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/mysql/install-mysql.sh
        configure: scripts/mysql/configure-mysql.sh
        start: scripts/mysql/start-mysql.sh
        stop: scripts/mysql/stop-mysql.sh

  wordpress.nodes.WordpressApplicationModule:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      port:
        description: Web application port
        type: integer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/wordpress/install-wordpress.sh
        configure: scripts/wordpress/set-mysql-url.sh
        start: scripts/wordpress/start-apache.sh
        stop: scripts/wordpress/stop-apache.sh

  wordpress.nodes.Nginx:
    derived_from: cloudify.nodes.LoadBalancer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/nginx/install-nginx.sh
        configure: scripts/nginx/configure-nginx.sh
        start: scripts/nginx/start-nginx.sh
        stop: scripts/nginx/stop-nginx.sh

  wordpress.nodes.Test:
    derived_from: cloudify.nodes.ApplicationModule
    interfaces:
      cloudify.interfaces.lifecycle:
        configure: scripts/test/configure-test.sh
          inputs:
            private_ip: { get_attribute: [SELF, host_ip] }
            public_ip: { get_attribute: [SELF, public_ip_address] }

relationships:

  node_connected_to_mysql:
    derived_from: cloudify.relationships.connected_to
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure: scripts/wordpress/set-mysql-url.sh

  node_connected_to_nginx:
    derived_from: cloudify.relationships.connected_to
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure: scripts/nginx/configure-nginx.sh
