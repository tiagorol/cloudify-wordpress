node_types:

  wordpress.nodes.MySQLDatabase:
    derived_from: cloudify.nodes.DBMS
    properties:
      port:
        description: MySQL port
        type: integer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/mysql/install-mysql.sh
        configure: scripts/mysql/configure-mysql.sh
        start: scripts/mysql/start-mysql.sh
        stop: scripts/mysql/stop-mysql.sh

  wordpress.nodes.WordpressApplicationModule:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      port:
        description: Web application port
        type: integer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/wordpress/install-wordpress.sh
        start: scripts/wordpress/start-apache.sh
        stop: scripts/wordpress/stop-apache.sh

  wordpress.nodes.Nginx:
    derived_from: cloudify.nodes.LoadBalancer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/nginx/install-nginx.sh
        configure: scripts/nginx/configure-nginx.sh
        start: scripts/nginx/start-nginx.sh
        stop: scripts/nginx/stop-nginx.sh
      cloudify.interfaces.monitoring:
        start: scripts/crawler/start-monitoring.sh

relationships:

  nginx_connected_to_vm:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure:
          implementation: scripts/nginx/postconfigure-nginx.sh
          inputs:
            backend_address:
              default: { get_attribute: [ TARGET, ip ] }

  node_connected_to_mysql:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure:
          implementation: scripts/wordpress/postconfigure-wordpress.sh
          inputs:
            database_address:
              default: { get_attribute: [ TARGET, ip ] }

  nginx_connected_to_db:
    derived_from: cloudify.relationships.connected_to
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        postconfigure: scripts/mysql/postconfigure-mysql.sh
